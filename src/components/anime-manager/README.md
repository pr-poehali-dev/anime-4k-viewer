# Anime Manager - Структура компонентов

Модуль управления аниме разбит на несколько переиспользуемых компонентов для улучшения читаемости и поддержки кода.

## Структура файлов

```
src/components/
├── AnimeManager.tsx           # Главный компонент (279 строк)
└── anime-manager/
    ├── README.md              # Эта документация
    ├── types.ts               # Общие TypeScript типы
    ├── AnimeListItem.tsx      # Карточка аниме в списке (40 строк)
    ├── AnimeForm.tsx          # Форма добавления/редактирования (187 строк)
    ├── CoverUpload.tsx        # Загрузка обложки (75 строк)
    └── VideoUpload.tsx        # Загрузка видео (92 строки)
```

## Описание компонентов

### AnimeManager.tsx (главный)
**Назначение:** Главный контейнер с логикой управления состоянием и API запросами

**Ответственность:**
- Управление состоянием (список аниме, форма, загрузка)
- API запросы (получение, создание, обновление, удаление)
- Конвертация файлов в base64
- Координация дочерних компонентов

**Не содержит:** Прямого JSX для списков и форм (делегируется дочерним компонентам)

---

### AnimeListItem.tsx
**Назначение:** Отображение одного аниме в списке

**Props:**
- `anime` - объект с данными аниме
- `onEdit` - callback для редактирования
- `onDelete` - callback для удаления

**Функции:**
- Отображение обложки, названия, рейтинга
- Показ доступных качеств видео (4K, 1080p, 720p)
- Кнопки редактирования и удаления
- Адаптивная верстка (мобильная/десктоп)

---

### AnimeForm.tsx
**Назначение:** Форма для добавления и редактирования аниме

**Props:**
- `formData` - данные формы
- `isEditing` - режим редактирования
- `isLoading` - состояние загрузки
- `error` - текст ошибки
- `uploadMode` - режим загрузки (file/url)
- `coverFile` - файл обложки
- `videoFiles` - файлы видео
- `onFormDataChange` - обработчик изменения данных
- `onUploadModeChange` - переключение режима загрузки
- `onCoverFileUpload` - загрузка обложки
- `onVideoFileUpload` - загрузка видео
- `onSave` - сохранение
- `onCancel` - отмена

**Функции:**
- Все поля формы (название, тип, рейтинг и т.д.)
- Интеграция компонентов CoverUpload и VideoUpload
- Отображение ошибок
- Адаптивная сетка полей

---

### CoverUpload.tsx
**Назначение:** Компонент загрузки обложки аниме

**Props:**
- `uploadMode` - режим (file/url)
- `coverFile` - загруженный файл
- `imageUrl` - URL изображения
- `onUploadModeChange` - переключатель режима
- `onFileUpload` - обработчик загрузки файла
- `onUrlChange` - обработчик изменения URL

**Функции:**
- Переключение между загрузкой файла и вводом URL
- Drag & drop зона для файлов
- Превью загруженного изображения
- Валидация (PNG, JPG до 5MB)

---

### VideoUpload.tsx
**Назначение:** Компонент загрузки видео разных качеств

**Props:**
- `uploadMode` - режим (file/url)
- `videoFiles` - загруженные файлы по качествам
- `videoUrls` - URLs для разных качеств
- `onFileUpload` - обработчик загрузки файла
- `onUrlChange` - обработчик изменения URL

**Функции:**
- Загрузка видео для 4K, 1080p, 720p, 480p
- Подсказка об автоматической конвертации
- Индикация загруженных файлов
- Переключение между файлами и URL

---

### types.ts
**Назначение:** Общие TypeScript интерфейсы

**Экспорты:**
- `Anime` - тип данных аниме из базы
- `AnimeFormData` - тип данных формы

**Преимущества:**
- Единое определение типов
- Переиспользование в компонентах
- Упрощение рефакторинга

## Преимущества декомпозиции

✅ **Читаемость** - каждый файл < 300 строк  
✅ **Переиспользование** - компоненты можно использовать отдельно  
✅ **Тестируемость** - легко писать тесты для каждого компонента  
✅ **Поддержка** - проще находить и исправлять баги  
✅ **Расширяемость** - легко добавлять новые функции  

## Пример использования

```tsx
import AnimeManager from '@/components/AnimeManager';

function App() {
  return (
    <AnimeManager 
      authToken="your-jwt-token" 
      onClose={() => console.log('closed')} 
    />
  );
}
```

## Взаимодействие компонентов

```
AnimeManager (главный контейнер)
  ├── AnimeListItem (для каждого аниме)
  │   ├── кнопка Edit → вызывает handleEdit
  │   └── кнопка Delete → вызывает handleDelete
  │
  └── AnimeForm (при добавлении/редактировании)
      ├── CoverUpload
      │   ├── режим file → загрузка файла
      │   └── режим url → ввод URL
      │
      └── VideoUpload
          ├── режим file → загрузка 4 файлов
          └── режим url → ввод 4 URLs
```

## Логика не изменена

⚠️ **ВАЖНО:** Декомпозиция сохранила всю логику без изменений:
- API запросы работают как раньше
- Конвертация файлов в base64 осталась
- Все обработчики событий идентичны
- Состояние управляется также

Изменилась только **организация кода** - логика распределена по файлам для улучшения структуры.
